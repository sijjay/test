name: Azure CLI Key Vault Access

on:
  workflow_dispatch:  # Allows manual trigger

permissions:
  id-token: write

jobs:
  azure-auth:
    runs-on: ubuntu-latest
    steps:

      # - name: Azure login
      #   uses: azure/login@v2
      #   with:
      #     client-id: 9de2854e-ce2d-422a-9ebf-514077017382
      #     tenant-id: 0e7f6f8b-dfc2-4a5d-9c14-6f3eb7a8fe8d
      #     allow-no-subscriptions: true

      - name: az login cli
        run: |
          az login --service-principal --username 9de2854e-ce2d-422a-9ebf-514077017382 --tenant 0e7f6f8b-dfc2-4a5d-9c14-6f3eb7a8fe8d

      - name: Fetch secrets from Azure Key Vault
        run: |
          SECRET_VALUE=$(az keyvault secret show --name "pilot-test-secret" --vault-name "pilot-kv-main" --query "value" -o tsv)
          echo "Fetched secret successfully."
          echo "${SECRET_VALUE}"
