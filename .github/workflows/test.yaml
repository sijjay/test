name: Azure CLI Key Vault Access

on:
  workflow_dispatch:  # Allows manual trigger

jobs:
  azure-auth:
    runs-on: ubuntu-latest
    steps:

      - name: Authenticate to Azure using Managed Identity
        run: |
          az login --identity --username 4722d169-f7d5-44f6-88d4-bfd24adce7f8
          echo "Logged into Azure using managed identity."

      - name: Fetch secrets from Azure Key Vault
        run: |
          SECRET_VALUE=$(az keyvault secret show --name "pilot-test-secret" --vault-name "pilot-kv-main" --query "value" -o tsv)
          echo "Fetched secret successfully."
